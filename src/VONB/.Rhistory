R[i,i:J]=rmultinom(1,ni[i],p)
print(cbind(ni,R))
End of data generation.
PARAMETER_SECTION
theta = list(log.m=log(0.5),log.fj=log(fj))# rep(0.1,length=J))
itheta = as.relistable(theta)
PROCEDURE_SECTION
brownie <- function(theta)
with(relist(theta,skeleton=itheta),{
m=exp(log.m)
fj=exp(log.fj)
compute predicted recaptures given ni
P=Z=F=Rhat=matrix(nrow=I,ncol=J)
cj = fj/(m+fj)*(1-exp(-m-fj))
nll = 0
for(i in 1:I)
tmp_m=(seq(1,length(i:J),1)-1)*m
tmp_f=c(0,cumsum(fj[i:(J-1)]))
Z[i,i:J]=tmp_m + tmp_f
p=exp(-Z[i,i:J])*cj[i:J]
Rhat[i,i:J]=ni[i]*p#rmultinom(1,ni[i],p)
nll=nll   +sum(-dpois(R[i,i:J],Rhat[i,i:J],log=TRUE))
nll=nll+sum(-dmultinom(R[i,i:J],prob=p,log=TRUE))
return(nll)
})
Solver routine to estimate parameters.
solver<-function(theta,objfun,hess=FALSE)
fit<-optim(theta,objfun,method="BFGS",hessian=hess)
if(hess==TRUE)
{
H=fit$hessian     #Matrix of 2nd derivatives
V=solve(H)        #Variance covariance matrix
std=sqrt(diag(V))  #Std of parameters
R=V/(std %o% std) #Correlations.
fit$R=R; fit$std=std
return(fit)
}
fit <- solver(unlist(itheta),brownie,TRUE)
print(exp(fit$par))
source('~/Documents/UBC_Courses/Fish_504/ASSIGNMENTS/FISHGROWTH/GrowthSim.R')
source('~/Documents/UBC_Courses/Fish_504/ASSIGNMENTS/FISHGROWTH/vonB.R')
fit$par
iF<-read.table(pipe("pbpaste"))
matplot(iF)
F<-read.table(pipe("pbpaste"))
matlines(F)
0.2
sqrt(0.2)
sqrt(1-0.2)
1-sqrt(0.2)
plot(bt)
bt=scan()
mean(bt)
mean(bt[-1])
abline(v=1)
xx <- read.table(pipe("pbpaste"))
matplot(xx[,2:4],xx[,5:7],type="l")
matplot(xx[,5:7],type="l")
ax
px
pwd
dir()
x=scan()
X=read.table(pipe("pbpaste"))
X
x
cbind(1978:2012,X)
cbind(1978:2012,1,X)
ps = read.table(pipe("pbpaste"))
ps
yr=1978:2012
yr
ii
yr[ii]
cbind(yr[ii],2,ps)
cbind(yr[ii],2,ps,0,0)
cbind(yr[ii],2,ps,V7=0,V8=0)
ct = read.table(pipe("pbpaste"))
ct
ii=scan()
cbind(yr[ii],ct)
o = read.table(pipe("pbpaste"))
o
cbind(yr[ii],gr=3,o)
cbind(yr[ii],gr=3,o,V4=0,V5=0,V6=0,V7=0,V8=0)
q()
vonBH.R#
#
# DATA SECTION#
require(Riscam)#
require(ggplot2)#
A 						<- read.admb("vonBH")#
A$rp 					<- read.table("vonBH.mcmc", header=TRUE)#
colnames(A$post.samp)	<- A$fit$names[1:A$fit$nopar]#
A$post.samp             <- as.data.frame(A$post.samp)#
#
sx          <- c("Female","Male")#
sa          <- c("2A","2B","2C","3A","3B","4A","4B","4C","4D")#
A$rp$area   <- sa[A$rp$area]#
A$rp$sex    <- sx[A$rp$sex]#
DF          <- data.frame(#
				area=sa[A$area],#
				sex=sx[A$sex], #
				age=A$age, #
				fl=A$fl, #
				fl_hat=A$fl_hat, #
				epsilon=A$epsilon)#
# GRAPHICAL SECTION#
# Index:#
# 		p1 <- length-at-age plots for male and female by area#
# 		p2 <- length-age by sex overlayed areas#
#       p3 <- residual distribution as box plots by sex#
#       p4 <- qqplot on residuals by area and sex#
# 		p5 <- qqplot on age residuals #
#		p6 <- weight-at-age fits by area and sex#
#       p7 <- Marginal posteriors for F0.1 for male and female by area panels#
#       p8 <- Marginal posterior plots for F0.1 for female by area.#
graphics.off()#
quartz("Size at age", width=10, height=6)#
p  <- ggplot(DF, aes(age, fl, col=factor(sex))) + geom_point(size=1, alpha=0.3) #
p  <- p + geom_line(aes(age, fl_hat, col=factor(sex)), size=1) #
p  <- p + facet_wrap(~area)#
p  <- p + labs(col="Sex") + xlab("Age (years)") + ylab("Fork length (cm)")#
p1 <- p#
 ggsave(p1, file="../../FIGS/fig:lengthAgeFit.pdf")#
#
p  <- ggplot(DF, aes(age, fl, col=area)) +geom_point(size=1)#
p  <- p + geom_line(aes(age, fl_hat, col=area), size=1) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Fork length (cm)")#
p2 <- p#
#
p  <- ggplot(DF, aes(factor(age), epsilon, col=sex))+geom_boxplot(outlier.size = 0.2)#
p  <- p + facet_wrap(~area) + labs(col="Sex")+xlab("Age (years)")+ylab("Residual fork length (cm)")#
p3 <- p#
#
# qq plots#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~area)#
p4 <- p#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~age)#
p5 <- p#
# Allometric relationship.#
# W = a L ^b; a 6.82e-6 b=3.24#
a  <- 6.83e-6#
b  <- 3.24#
p  <- ggplot(DF, aes(age, a*fl^b, col=area)) +geom_point(size=1)#
p  <- p + geom_point(aes(age, a*fl_hat^b, col=area), size=2) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Weight-at-age (lb)")#
p6 <- p#
# Marginal posteriors for F0.1#
p  <- ggplot(A$rp, aes(x=F0.1, fill=sex)) +geom_density(adjust=2, size=0.0, alpha=0.5)#
p  <- p +labs(fill="sex") + xlim(c(0, 1.0)) + facet_wrap(~area) #
p7 <- p#
p  <- ggplot(subset(A$rp, sex=="Female"), aes(x=F0.1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
p8 <- p#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L1")), aes(x=L1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL1 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L2")), aes(x=L2, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL2 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "rho")), aes(x=-log(rho), fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p +labs(x="Growth coefficient (k)") + facet_wrap(~sex, scales="free") #
pk <- p#
# Table for growth parameter estimates#
# A.post.samp has the posterior samples for l1,  l2,  rho,  cv for each of the stocks.#
narea <- length(unique(A$area))
A$ps
require(reshape2)
mdf = melt(A$rp,id.vars=c("sex","area"))
head(mdf)
tail(mdf)
p<-ggplot(mdf,aes(b)) + geom_density()
p<-ggplot(mdf,aes(b)) + geom_density() +facet_wrap(~sex)
hist(A$rp$b)
?ggplot
p<-ggplot(mdf,aes(b)) + geom_line() +facet_wrap(~sex)
p<-ggplot(mdf,aes(x=value)) + geom_line() +facet_wrap(~sex)
p<-ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_line() +facet_wrap(~sex)
p<-ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_density() +facet_wrap(~sex)
p<-ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_density(col=area) +facet_wrap(~sex)
p<-ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)
p
vonBH.R#
#
# DATA SECTION#
require(Riscam)#
require(ggplot2)#
A 						<- read.admb("vonBH")#
A$rp 					<- read.table("vonBH.mcmc", header=TRUE)#
colnames(A$post.samp)	<- A$fit$names[1:A$fit$nopar]#
A$post.samp             <- as.data.frame(A$post.samp)#
#
sx          <- c("Female","Male")#
sa          <- c("2A","2B","2C","3A","3B","4A","4B","4C","4D")#
A$rp$area   <- sa[A$rp$area]#
A$rp$sex    <- sx[A$rp$sex]#
DF          <- data.frame(#
				area=sa[A$area],#
				sex=sx[A$sex], #
				age=A$age, #
				fl=A$fl, #
				fl_hat=A$fl_hat, #
				epsilon=A$epsilon)#
# GRAPHICAL SECTION#
# Index:#
# 		p1 <- length-at-age plots for male and female by area#
# 		p2 <- length-age by sex overlayed areas#
#       p3 <- residual distribution as box plots by sex#
#       p4 <- qqplot on residuals by area and sex#
# 		p5 <- qqplot on age residuals #
#		p6 <- weight-at-age fits by area and sex#
#       p7 <- Marginal posteriors for F0.1 for male and female by area panels#
#       p8 <- Marginal posterior plots for F0.1 for female by area.#
graphics.off()#
quartz("Size at age", width=10, height=6)#
p  <- ggplot(DF, aes(age, fl, col=factor(sex))) + geom_point(size=1, alpha=0.3) #
p  <- p + geom_line(aes(age, fl_hat, col=factor(sex)), size=1) #
p  <- p + facet_wrap(~area)#
p  <- p + labs(col="Sex") + xlab("Age (years)") + ylab("Fork length (cm)")#
p1 <- p#
 ggsave(p1, file="../../FIGS/fig:lengthAgeFit.pdf")#
#
p  <- ggplot(DF, aes(age, fl, col=area)) +geom_point(size=1)#
p  <- p + geom_line(aes(age, fl_hat, col=area), size=1) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Fork length (cm)")#
p2 <- p#
#
p  <- ggplot(DF, aes(factor(age), epsilon, col=sex))+geom_boxplot(outlier.size = 0.2)#
p  <- p + facet_wrap(~area) + labs(col="Sex")+xlab("Age (years)")+ylab("Residual fork length (cm)")#
p3 <- p#
#
# qq plots#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~area)#
p4 <- p#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~age)#
p5 <- p#
# Allometric relationship.#
# W = a L ^b; a 6.82e-6 b=3.24#
a  <- 6.83e-6#
b  <- 3.24#
p  <- ggplot(DF, aes(age, a*fl^b, col=area)) +geom_point(size=1)#
p  <- p + geom_point(aes(age, a*fl_hat^b, col=area), size=2) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Weight-at-age (lb)")#
p6 <- p#
# Marginal posteriors for F0.1#
p  <- ggplot(A$rp, aes(x=F0.1, fill=sex)) +geom_density(adjust=2, size=0.0, alpha=0.5)#
p  <- p +labs(fill="sex") + xlim(c(0, 1.0)) + facet_wrap(~area) #
p7 <- p#
p  <- ggplot(subset(A$rp, sex=="Female"), aes(x=F0.1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
p8 <- p#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L1")), aes(x=L1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL1 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L2")), aes(x=L2, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL2 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "rho")), aes(x=-log(rho), fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p +labs(x="Growth coefficient (k)") + facet_wrap(~sex, scales="free") #
pk <- p#
#
# Marginal posteriors for hyper parameters L1,  L2,  rho,  b#
require(reshape2)#
mdf <- melt(A$rp,id.vars=c("sex","area"))#
pM4 <- ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
# Table for growth parameter estimates#
# A.post.samp has the posterior samples for l1,  l2,  rho,  cv for each of the stocks.#
narea <- length(unique(A$area))
head(A$rp)
pM1 <- ggplot(subset(mdf,variable=="L1"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)
pM2 <- ggplot(subset(mdf,variable=="L2"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM3 <- ggplot(subset(mdf,variable=="rho"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)
exp(-1.0)
-log(1)
-log(1.3)
exp(-0.2)
log(0.999)
log(0.91)
log(1.1)
-log(1.1)
-log(0.9999)
-log(1,0)
-log(10)
-log(1.0)
1/2
1/0.1
1/1.1
1/1.00001
p3
p5
p7
sqrt(0.1)
0.1^2
sqrt(0.01)
pairs(A$post.samp[,1:11])
pairs(A$post.samp[,1:11],gap=0)
hist(A$post.samp[,1])
hist(A$post.samp[,2])
pM1
pM2
A$fl
names(A)
matplot(A$p_fl)
matplot(t(A$p_fl))
p2
p1()
source("vonbh.r")
vonBH.R#
#
# DATA SECTION#
require(Riscam)#
require(ggplot2)#
A 						<- read.admb("vonBH")#
A$rp 					<- read.table("vonBH.mcmc", header=TRUE)#
colnames(A$post.samp)	<- A$fit$names[1:A$fit$nopar]#
A$post.samp             <- as.data.frame(A$post.samp)#
#
sx          <- c("Female","Male")#
sa          <- c("2A","2B","2C","3A","3B","4A","4B","4C","4D")#
A$rp$area   <- sa[A$rp$area]#
A$rp$sex    <- sx[A$rp$sex]#
DF          <- data.frame(#
				area=sa[A$area],#
				sex=sx[A$sex], #
				age=A$age, #
				fl=A$fl, #
				fl_hat=A$fl_hat, #
				epsilon=A$epsilon)#
# GRAPHICAL SECTION#
# Index:#
# 		p1 <- length-at-age plots for male and female by area#
# 		p2 <- length-age by sex overlayed areas#
#       p3 <- residual distribution as box plots by sex#
#       p4 <- qqplot on residuals by area and sex#
# 		p5 <- qqplot on age residuals #
#		p6 <- weight-at-age fits by area and sex#
#       p7 <- Marginal posteriors for F0.1 for male and female by area panels#
#       p8 <- Marginal posterior plots for F0.1 for female by area.#
graphics.off()#
quartz("Size at age", width=10, height=6)#
p  <- ggplot(DF, aes(age, fl, col=factor(sex))) + geom_point(size=1, alpha=0.3) #
p  <- p + geom_line(aes(age, fl_hat, col=factor(sex)), size=1) #
p  <- p + facet_wrap(~area)#
p  <- p + labs(col="Sex") + xlab("Age (years)") + ylab("Fork length (cm)")#
p1 <- p#
 ggsave(p1, file="../../FIGS/fig:lengthAgeFit.pdf")#
#
p  <- ggplot(DF, aes(age, fl, col=area)) +geom_point(size=1)#
p  <- p + geom_line(aes(age, fl_hat, col=area), size=1) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Fork length (cm)")#
p2 <- p#
#
p  <- ggplot(DF, aes(factor(age), epsilon, col=sex))+geom_boxplot(outlier.size = 0.2)#
p  <- p + facet_wrap(~area) + labs(col="Sex")+xlab("Age (years)")+ylab("Residual fork length (cm)")#
p3 <- p#
#
# qq plots#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~area)#
p4 <- p#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~age)#
p5 <- p#
# Allometric relationship.#
# W = a L ^b; a 6.82e-6 b=3.24#
a  <- 6.83e-6#
b  <- 3.24#
p  <- ggplot(DF, aes(age, a*fl^b, col=area)) +geom_point(size=1)#
p  <- p + geom_point(aes(age, a*fl_hat^b, col=area), size=2) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Weight-at-age (lb)")#
p6 <- p#
# Marginal posteriors for F0.1#
p  <- ggplot(A$rp, aes(x=F0.1, fill=sex)) +geom_density(adjust=2, size=0.0, alpha=0.5)#
p  <- p +labs(fill="sex") + xlim(c(0, 1.0)) + facet_wrap(~area) #
p7 <- p#
p  <- ggplot(subset(A$rp, sex=="Female"), aes(x=F0.1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
p8 <- p#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L1")), aes(x=L1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL1 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L2")), aes(x=L2, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL2 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "rho")), aes(x=-log(rho), fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p +labs(x="Growth coefficient (k)") + facet_wrap(~sex, scales="free") #
pk <- p#
#
# Marginal posteriors for hyper parameters L1,  L2,  rho,  b#
require(reshape2)#
mdf <- melt(A$rp,id.vars=c("sex","area"))#
pM1 <- ggplot(subset(mdf,variable=="L1"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM2 <- ggplot(subset(mdf,variable=="L2"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM3 <- ggplot(subset(mdf,variable=="rho"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM4 <- ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
# Table for growth parameter estimates#
# A.post.samp has the posterior samples for l1,  l2,  rho,  cv for each of the stocks.#
narea <- length(unique(A$area))
dim(A$post.samp)
length(A$fit$parname)
length(A$fit$names)
A$fit$nopar
A 						<- read.admb("vonBH")#
A$rp 					<- read.table("vonBH.mcmc", header=TRUE)#
colnames(A$post.samp)	<- A$fit$names[1:(A$fit$nopar+1)]#
A$post.samp             <- as.data.frame(A$post.samp)
A 						<- read.admb("vonBH")#
A$rp 					<- read.table("vonBH.mcmc", header=TRUE)#
colnames(A$post.samp)	<- A$fit$names[1:(A$fit$nopar-1)]
vonBH.R#
#
# DATA SECTION#
require(Riscam)#
require(ggplot2)#
A 						<- read.admb("vonBH")#
A$rp 					<- read.table("vonBH.mcmc", header=TRUE)#
colnames(A$post.samp)	<- A$fit$names[1:(A$fit$nopar-1)]#
A$post.samp             <- as.data.frame(A$post.samp)#
#
sx          <- c("Female","Male")#
sa          <- c("2A","2B","2C","3A","3B","4A","4B","4C","4D")#
A$rp$area   <- sa[A$rp$area]#
A$rp$sex    <- sx[A$rp$sex]#
DF          <- data.frame(#
				area=sa[A$area],#
				sex=sx[A$sex], #
				age=A$age, #
				fl=A$fl, #
				fl_hat=A$fl_hat, #
				epsilon=A$epsilon)#
# GRAPHICAL SECTION#
# Index:#
# 		p1 <- length-at-age plots for male and female by area#
# 		p2 <- length-age by sex overlayed areas#
#       p3 <- residual distribution as box plots by sex#
#       p4 <- qqplot on residuals by area and sex#
# 		p5 <- qqplot on age residuals #
#		p6 <- weight-at-age fits by area and sex#
#       p7 <- Marginal posteriors for F0.1 for male and female by area panels#
#       p8 <- Marginal posterior plots for F0.1 for female by area.#
graphics.off()#
quartz("Size at age", width=10, height=6)#
p  <- ggplot(DF, aes(age, fl, col=factor(sex))) + geom_point(size=1, alpha=0.3) #
p  <- p + geom_line(aes(age, fl_hat, col=factor(sex)), size=1) #
p  <- p + facet_wrap(~area)#
p  <- p + labs(col="Sex") + xlab("Age (years)") + ylab("Fork length (cm)")#
p1 <- p#
 ggsave(p1, file="../../FIGS/fig:lengthAgeFit.pdf")#
#
p  <- ggplot(DF, aes(age, fl, col=area)) +geom_point(size=1)#
p  <- p + geom_line(aes(age, fl_hat, col=area), size=1) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Fork length (cm)")#
p2 <- p#
#
p  <- ggplot(DF, aes(factor(age), epsilon, col=sex))+geom_boxplot(outlier.size = 0.2)#
p  <- p + facet_wrap(~area) + labs(col="Sex")+xlab("Age (years)")+ylab("Residual fork length (cm)")#
p3 <- p#
#
# qq plots#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~area)#
p4 <- p#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~age)#
p5 <- p#
# Allometric relationship.#
# W = a L ^b; a 6.82e-6 b=3.24#
a  <- 6.83e-6#
b  <- 3.24#
p  <- ggplot(DF, aes(age, a*fl^b, col=area)) +geom_point(size=1)#
p  <- p + geom_point(aes(age, a*fl_hat^b, col=area), size=2) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Weight-at-age (lb)")#
p6 <- p#
# Marginal posteriors for F0.1#
p  <- ggplot(A$rp, aes(x=F0.1, fill=sex)) +geom_density(adjust=2, size=0.0, alpha=0.5)#
p  <- p +labs(fill="sex") + xlim(c(0, 1.0)) + facet_wrap(~area) #
p7 <- p#
p  <- ggplot(subset(A$rp, sex=="Female"), aes(x=F0.1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
p8 <- p#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L1")), aes(x=L1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL1 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L2")), aes(x=L2, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL2 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "rho")), aes(x=-log(rho), fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p +labs(x="Growth coefficient (k)") + facet_wrap(~sex, scales="free") #
pk <- p#
#
# Marginal posteriors for hyper parameters L1,  L2,  rho,  b#
require(reshape2)#
mdf <- melt(A$rp,id.vars=c("sex","area"))#
pM1 <- ggplot(subset(mdf,variable=="L1"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM2 <- ggplot(subset(mdf,variable=="L2"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM3 <- ggplot(subset(mdf,variable=="rho"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM4 <- ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
# Table for growth parameter estimates#
# A.post.samp has the posterior samples for l1,  l2,  rho,  cv for each of the stocks.#
narea <- length(unique(A$area))
p1
A$pfl
A$p_fl
age = 1:15
m=0.2
exp(-m*age-1)
exp(-m*(age-1))
plot(exp(-m*(age-1)))
lx=exp(-m*(age-1))
linf=100
winf=100
wa = winf*(1-exp(-m/1.5*age))^3
plot(age,wa)
lx
plot(lx*wa)
lx*wa
lines(lx*wa)
diff(wa)
wa
wa/max(wa)
wa/max(wa)*100
cbind(age,round(wa/max(wa)*100,0))
cbind(age,lx,round(wa/max(wa)*100,0))
cbind(age,round(lx*100,0),round(wa/max(wa)*100,0))
cbind(age,round(lx*100,0)/67,round(wa/max(wa)*100,0))
cbind(age,round(lx*100,0)/.67,round(wa/max(wa)*100,0))
plot(age,lx,xlab="",ylab="")
plot(age,lx,xlab="",ylab="",type="l",lwd=5)
plot(age,lx,xlab="",ylab="",type="l",lwd=5,bty="n")
plot(age,lx,xlab="",ylab="",type="l",lwd=5,bty="l")
plot(age,wa,xlab="",ylab="",type="l",lwd=5,bty="l",col="gold")
plot(age,wa/max(wa)*lx,xlab="",ylab="",type="l",lwd=5,bty="l",col="steelblue")
sa=plogis(age,8,0.5)
sa
lines(age,sa,lwd=2,alpha=0.5)
plot(age,sa*wa/max(wa)*lx,xlab="",ylab="",type="l",lwd=5,bty="l",col="salmon")
plot(age,lx)
par(xaxt="n",yaxt="n")
plot(age,lx,ylab="Survivorship",xlab="Age",type="l",lwd=5, cex.lab=2)
par(xaxt="n",yaxt="n",las=1)
par(xaxt="n",yaxt="n",mar=c(5,5,1,1))
par(mar=c(5,5,1,1),las=1)
par(mar=c(5,5,1,1),las=1,cex.lab=2,cex=1.5)
plot(age,lx,ylab="Survivorship",xlab="Age",type="l",lwd=5, cex.lab=1.75)
plot(age,wa/max(wa),ylab="Survivorship",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,1))
plot(age,sa,xlab="",ylab="",type="l",lwd=5,bty="l",col="steelblue")
plot(age,lx*sa*wa/max(wa),ylab="Selectivity",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,1))
par(mar=c(5,5,1,1),las=1,cex.lab=2,cex=1.5,bty="l")
plot(age,sa,ylab="Selectivity",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,1))
plot(age,wa/max(wa),ylab="Weight-at-age",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,1))
1-exp(-0.215)
u=1-exp(-0.215)
u
lz = 1
for(i in 2:15) lz[i]=lz[i-1]*u*sa[i-1]
for(i in 2:15) lz[i]=lz[i-1]*(1-u*sa[i-1])
for(i in 2:15) lz[i]=lz[i-1]*exp(-M)*(1-u*sa[i-1])
M
m
for(i in 2:15) lz[i]=lz[i-1]*exp(-m)*(1-u*sa[i-1])
lz
lines(age,lz,col=2,lwd=5)
require(Riscam)
colr()
colr
setwd('/Users/stevenmartell1/Documents/iSCAM-project/src/r-code/R')
colr <- #
function(col.pal=1,a=1)#
{#
    col.rgb<-col2rgb(col.pal)/255#
    rgb(t(col.rgb),alpha=a)#
}
plot(age,lx,ylab="Survivorship",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,1),col=colr(1,0.5))
plot(age,lx,ylab="Survivorship",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,1))
lines(age,lz,col=colr(2,0.5),lwd=5)
plot(age,lx*sa*wa/max(wa),ylab="Exploitable biomass",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,1))
plot(age,lx*sa*wa/max(wa),ylab="Exploitable biomass",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,.2))
lines(age,lz*sa*wa/max(wa),col=colr(2,0.5),lwd=5)
xx=c(age,rev(age))
y
polygon(xx,yy)
y=lx*sa*wa/max(wa)
polygon(xx,yy,col=colr(1,.5))
plot(age,lx*sa*wa/max(wa),ylab="Exploitable biomass",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,.15))
y=lz*sa*wa/max(wa)
plot(age,lx*sa*wa/max(wa),ylab="Spawning biomass",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,.2))
plot(age,lx*sa*wa/max(wa),ylab="Spawning biomass",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,.15))
ma = plogis(age,11,1.5)
plot(age,lx*ma*wa/max(wa),ylab="Spawning biomass",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,.15))
y=lz*ma*wa/max(wa)
yy=c(y,rep(0,length(y)))
polygon(xx,yy,col=colr(2,.5))
plot(age,ma,ylab="Maturity",xlab="Age",type="l",lwd=5, cex.lab=1.75,ylim=c(0,1))
vonBH.R#
#
# DATA SECTION#
require(Riscam)#
require(ggplot2)#
A 						<- read.admb("vonBH")#
A$rp 					<- read.table("vonBH.mcmc", header=TRUE)#
colnames(A$post.samp)	<- A$fit$names[1:(A$fit$nopar-1)]#
A$post.samp             <- as.data.frame(A$post.samp)#
#
sx          <- c("Female","Male")#
sa          <- c("2A","2B","2C","3A","3B","4A","4B","4C","4D")#
A$rp$area   <- sa[A$rp$area]#
A$rp$sex    <- sx[A$rp$sex]#
DF          <- data.frame(#
				area=sa[A$area],#
				sex=sx[A$sex], #
				age=A$age, #
				fl=A$fl, #
				fl_hat=A$fl_hat, #
				epsilon=A$epsilon)#
# GRAPHICAL SECTION#
# Index:#
# 		p1 <- length-at-age plots for male and female by area#
# 		p2 <- length-age by sex overlayed areas#
#       p3 <- residual distribution as box plots by sex#
#       p4 <- qqplot on residuals by area and sex#
# 		p5 <- qqplot on age residuals #
#		p6 <- weight-at-age fits by area and sex#
#       p7 <- Marginal posteriors for F0.1 for male and female by area panels#
#       p8 <- Marginal posterior plots for F0.1 for female by area.#
graphics.off()#
quartz("Size at age", width=10, height=6)#
p  <- ggplot(DF, aes(age, fl, col=factor(sex))) + geom_point(size=1, alpha=0.3) #
p  <- p + geom_line(aes(age, fl_hat, col=factor(sex)), size=1) #
p  <- p + facet_wrap(~area)#
p  <- p + labs(col="Sex") + xlab("Age (years)") + ylab("Fork length (cm)")#
p1 <- p#
 ggsave(p1, file="../../FIGS/fig:lengthAgeFit.pdf")#
#
p  <- ggplot(DF, aes(age, fl, col=area)) +geom_point(size=1)#
p  <- p + geom_line(aes(age, fl_hat, col=area), size=1) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Fork length (cm)")#
p2 <- p#
#
p  <- ggplot(DF, aes(factor(age), epsilon, col=sex))+geom_boxplot(outlier.size = 0.2)#
p  <- p + facet_wrap(~area) + labs(col="Sex")+xlab("Age (years)")+ylab("Residual fork length (cm)")#
p3 <- p#
#
# qq plots#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~area)#
p4 <- p#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~age)#
p5 <- p#
# Allometric relationship.#
# W = a L ^b; a 6.82e-6 b=3.24#
a  <- 6.83e-6#
b  <- 3.24#
p  <- ggplot(DF, aes(age, a*fl^b, col=area)) +geom_point(size=1)#
p  <- p + geom_point(aes(age, a*fl_hat^b, col=area), size=2) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Weight-at-age (lb)")#
p6 <- p#
# Marginal posteriors for F0.1#
p  <- ggplot(A$rp, aes(x=F0.1, fill=sex)) +geom_density(adjust=2, size=0.0, alpha=0.5)#
p  <- p +labs(fill="sex") + xlim(c(0, 1.0)) + facet_wrap(~area) #
p7 <- p#
p  <- ggplot(subset(A$rp, sex=="Female"), aes(x=F0.1, fill=area)) +geom_density(size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
p8 <- p#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L1")), aes(x=L1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL1 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L2")), aes(x=L2, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL2 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "rho")), aes(x=-log(rho), fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p +labs(x="Growth coefficient (k)") + facet_wrap(~sex, scales="free") #
pk <- p#
#
# Marginal posteriors for hyper parameters L1,  L2,  rho,  b#
require(reshape2)#
mdf <- melt(A$rp,id.vars=c("sex","area"))#
pM1 <- ggplot(subset(mdf,variable=="L1"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM2 <- ggplot(subset(mdf,variable=="L2"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM3 <- ggplot(subset(mdf,variable=="rho"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM4 <- ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
# Table for growth parameter estimates#
# A.post.samp has the posterior samples for l1,  l2,  rho,  cv for each of the stocks.#
narea <- length(unique(A$area))
setwd('/Users/stevenmartell1/Documents/IPHC/SizeLimitz/src/VONB')
vonBH.R#
#
# DATA SECTION#
require(Riscam)#
require(ggplot2)#
A 						<- read.admb("vonBH")#
A$rp 					<- read.table("vonBH.mcmc", header=TRUE)#
colnames(A$post.samp)	<- A$fit$names[1:(A$fit$nopar-1)]#
A$post.samp             <- as.data.frame(A$post.samp)#
#
sx          <- c("Female","Male")#
sa          <- c("2A","2B","2C","3A","3B","4A","4B","4C","4D")#
A$rp$area   <- sa[A$rp$area]#
A$rp$sex    <- sx[A$rp$sex]#
DF          <- data.frame(#
				area=sa[A$area],#
				sex=sx[A$sex], #
				age=A$age, #
				fl=A$fl, #
				fl_hat=A$fl_hat, #
				epsilon=A$epsilon)#
# GRAPHICAL SECTION#
# Index:#
# 		p1 <- length-at-age plots for male and female by area#
# 		p2 <- length-age by sex overlayed areas#
#       p3 <- residual distribution as box plots by sex#
#       p4 <- qqplot on residuals by area and sex#
# 		p5 <- qqplot on age residuals #
#		p6 <- weight-at-age fits by area and sex#
#       p7 <- Marginal posteriors for F0.1 for male and female by area panels#
#       p8 <- Marginal posterior plots for F0.1 for female by area.#
graphics.off()#
quartz("Size at age", width=10, height=6)#
p  <- ggplot(DF, aes(age, fl, col=factor(sex))) + geom_point(size=1, alpha=0.3) #
p  <- p + geom_line(aes(age, fl_hat, col=factor(sex)), size=1) #
p  <- p + facet_wrap(~area)#
p  <- p + labs(col="Sex") + xlab("Age (years)") + ylab("Fork length (cm)")#
p1 <- p#
 ggsave(p1, file="../../FIGS/fig:lengthAgeFit.pdf")#
#
p  <- ggplot(DF, aes(age, fl, col=area)) +geom_point(size=1)#
p  <- p + geom_line(aes(age, fl_hat, col=area), size=1) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Fork length (cm)")#
p2 <- p#
#
p  <- ggplot(DF, aes(factor(age), epsilon, col=sex))+geom_boxplot(outlier.size = 0.2)#
p  <- p + facet_wrap(~area) + labs(col="Sex")+xlab("Age (years)")+ylab("Residual fork length (cm)")#
p3 <- p#
#
# qq plots#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~area)#
p4 <- p#
p  <- ggplot(DF, aes(sample=epsilon, col=sex)) + stat_qq()#
p  <- p + facet_wrap(~age)#
p5 <- p#
# Allometric relationship.#
# W = a L ^b; a 6.82e-6 b=3.24#
a  <- 6.83e-6#
b  <- 3.24#
p  <- ggplot(DF, aes(age, a*fl^b, col=area)) +geom_point(size=1)#
p  <- p + geom_point(aes(age, a*fl_hat^b, col=area), size=2) + facet_wrap(~sex)#
p  <- p + labs(col="Regulatory\nArea") + xlab("Age (years)") + ylab("Weight-at-age (lb)")#
p6 <- p#
# Marginal posteriors for F0.1#
p  <- ggplot(A$rp, aes(x=F0.1, fill=sex)) +geom_density(adjust=2, size=0.0, alpha=0.5)#
p  <- p +labs(fill="sex") + xlim(c(0, 1.0)) + facet_wrap(~area) #
p7 <- p#
p  <- ggplot(subset(A$rp, sex=="Female"), aes(x=F0.1, fill=area)) +geom_density(size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
p8 <- p#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L1")), aes(x=L1, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL1 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "L2")), aes(x=L2, fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p  + facet_wrap(~sex, scales="free") #
pL2 <- p#
#
p  <- ggplot(subset(A$rp, select=c("sex", "area", "rho")), aes(x=-log(rho), fill=area)) +geom_density(adjust=1.5, size=0.1, alpha=0.25)#
p  <- p +labs(x="Growth coefficient (k)") + facet_wrap(~sex, scales="free") #
pk <- p#
#
# Marginal posteriors for hyper parameters L1,  L2,  rho,  b#
require(reshape2)#
mdf <- melt(A$rp,id.vars=c("sex","area"))#
pM1 <- ggplot(subset(mdf,variable=="L1"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM2 <- ggplot(subset(mdf,variable=="L2"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM3 <- ggplot(subset(mdf,variable=="rho"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM4 <- ggplot(subset(mdf,variable=="b"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
pM5 <- ggplot(subset(mdf,variable=="cv"),aes(x=value)) + geom_density(aes(col=area)) +facet_wrap(~sex)#
# Table for growth parameter estimates#
# A.post.samp has the posterior samples for l1,  l2,  rho,  cv for each of the stocks.#
narea <- length(unique(A$area))
pM5
pM3
pM4
p8
require(MCMCpack)
plot(A$post.samp[,1])
plot(A$post.samp[,1],type="l")
plot(mcmc(A$post.samp[,1]))
plot(mcmc(A$post.samp[,2]))
